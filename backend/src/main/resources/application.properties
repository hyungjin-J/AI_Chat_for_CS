spring.application.name=backend
spring.jackson.property-naming-strategy=SNAKE_CASE

management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=always

server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

spring.datasource.url=${DB_URL:jdbc:h2:mem:aichatbot;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH}
spring.datasource.username=${DB_USERNAME:sa}
spring.datasource.password=${DB_PASSWORD:}
spring.datasource.driver-class-name=${DB_DRIVER:org.h2.Driver}
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
mybatis.mapper-locations=classpath:mappers/**/*.xml
mybatis.type-aliases-package=com.aichatbot
mybatis.type-handlers-package=com.aichatbot.global.mybatis
mybatis.configuration.map-underscore-to-camel-case=true
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.timeout=${REDIS_TIMEOUT:2s}

app.jwt.secret=${APP_JWT_SECRET:change-me-in-prod-change-me-in-prod-change-me-in-prod}
app.jwt.access-expiration-sec=${APP_JWT_ACCESS_EXPIRATION_SEC:3600}
app.jwt.refresh-expiration-sec=${APP_JWT_REFRESH_EXPIRATION_SEC:1209600}
app.security.allow-header-auth=${APP_SECURITY_ALLOW_HEADER_AUTH:true}

app.trace.require-header=${APP_TRACE_REQUIRE_HEADER:true}

app.auth.lockout-threshold=${APP_AUTH_LOCKOUT_THRESHOLD:5}
app.auth.lockout-minutes=${APP_AUTH_LOCKOUT_MINUTES:15}
app.auth.rate-limit-per-minute=${APP_AUTH_RATE_LIMIT_PER_MINUTE:20}
app.auth.rate-limit-redis-key-prefix=${APP_AUTH_RATE_LIMIT_REDIS_KEY_PREFIX:rl:auth:login:}
app.auth.refresh-cookie-name=${APP_AUTH_REFRESH_COOKIE_NAME:refresh_token}
app.auth.refresh-cookie-path=${APP_AUTH_REFRESH_COOKIE_PATH:/v1/auth}
app.auth.same-site=${APP_AUTH_SAME_SITE:Lax}
app.auth.refresh-cookie-secure=${APP_AUTH_REFRESH_COOKIE_SECURE:false}
app.auth.refresh-body-fallback-dev-test=${APP_AUTH_REFRESH_BODY_FALLBACK_DEV_TEST:true}
app.auth.refresh-body-fallback-prod=${APP_AUTH_REFRESH_BODY_FALLBACK_PROD:false}
app.auth.refresh-body-fallback-prod-client-types=${APP_AUTH_REFRESH_BODY_FALLBACK_PROD_CLIENT_TYPES:}
app.auth.csrf-origin-allowlist=${APP_AUTH_CSRF_ORIGIN_ALLOWLIST:http://localhost:5173,http://127.0.0.1:5173}
app.auth.csrf-origin-missing-allow-client-types=${APP_AUTH_CSRF_ORIGIN_MISSING_ALLOW_CLIENT_TYPES:trusted_cli}
app.auth.runtime-mode=${APP_AUTH_RUNTIME_MODE:dev}
app.auth.mfa-enforce-ops-admin=${APP_AUTH_MFA_ENFORCE_OPS_ADMIN:false}
app.auth.mfa-challenge-ttl-minutes=${APP_AUTH_MFA_CHALLENGE_TTL_MINUTES:10}
app.auth.mfa-max-attempts=${APP_AUTH_MFA_MAX_ATTEMPTS:5}
app.auth.mfa-lock-minutes=${APP_AUTH_MFA_LOCK_MINUTES:5}
app.auth.mfa-recovery-code-count=${APP_AUTH_MFA_RECOVERY_CODE_COUNT:10}
app.auth.mfa-recovery-code-ttl-days=${APP_AUTH_MFA_RECOVERY_CODE_TTL_DAYS:365}
app.auth.mfa-issuer=${APP_AUTH_MFA_ISSUER:AI_Chatbot}

app.answer.evidence-threshold=${APP_ANSWER_EVIDENCE_THRESHOLD:0.7}
app.rag.top-k-default=${APP_RAG_TOP_K_DEFAULT:3}
app.rag.top-k-max=${APP_RAG_TOP_K_MAX:5}

app.budget.input-token-max=${APP_BUDGET_INPUT_TOKEN_MAX:1500}
app.budget.output-token-max=${APP_BUDGET_OUTPUT_TOKEN_MAX:1500}
app.budget.tool-call-max=${APP_BUDGET_TOOL_CALL_MAX:3}
app.budget.session-budget-max=${APP_BUDGET_SESSION_BUDGET_MAX:10000}
app.budget.sse-concurrency-max-per-user=${APP_BUDGET_SSE_CONCURRENCY_MAX_PER_USER:2}
app.budget.sse-hold-ms=${APP_BUDGET_SSE_HOLD_MS:0}
app.idempotency.store=${APP_IDEMPOTENCY_STORE:memory}
app.idempotency.ttl-seconds=${APP_IDEMPOTENCY_TTL_SECONDS:86400}
app.idempotency.redis-key-prefix=${APP_IDEMPOTENCY_REDIS_KEY_PREFIX:idempotency:}
app.idempotency.redis-fail-strategy=${APP_IDEMPOTENCY_REDIS_FAIL_STRATEGY:fallback_memory}

app.llm.provider=${APP_LLM_PROVIDER:ollama}
app.llm.ollama.base-url=${APP_OLLAMA_BASE_URL:http://localhost:11434}
app.llm.ollama.model=${APP_OLLAMA_MODEL:qwen2.5:3b-instruct}
app.llm.ollama.temperature=${APP_OLLAMA_TEMPERATURE:0.0}
app.llm.ollama.top-p=${APP_OLLAMA_TOP_P:0.8}
